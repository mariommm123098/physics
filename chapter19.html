<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Physics Ch.19: Oscillations</title>
    <style>
        :root {
            --bg-color: #FAFAFA;
            --text-color: #111111;
            --accent-purple: #E0BBE4;
            --accent-green: #D2F5E3;
            --accent-yellow: #FFF7BC;
            --accent-blue: #D6E4FF;
            --border-width: 3px;
            --card-radius: 20px;
            --font-main: 'Helvetica Neue', Arial, sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-main);
            height: 100vh;
            width: 100vw;
            overflow: hidden; /* 禁止滚动 */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* 顶部栏：语言切换 */
        .top-bar {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
        }

        .lang-btn {
            background: black;
            color: white;
            border: none;
            padding: 8px 16px;
            font-weight: bold;
            font-size: 0.9rem;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 2px 2px 0px rgba(0,0,0,0.2);
        }
        
        .lang-btn:active {
            transform: scale(0.95);
        }

        /* 主舞台 */
        .stage {
            width: 90%;
            max-width: 500px;
            height: 70vh; /* 卡片高度 */
            position: relative;
            perspective: 1000px;
        }

        /* 卡片样式 */
        .card {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            border: var(--border-width) solid black;
            border-radius: var(--card-radius);
            padding: 24px;
            box-shadow: 8px 8px 0px black;
            display: flex;
            flex-direction: column;
            opacity: 0;
            transform: translateX(100px) scale(0.9);
            pointer-events: none;
            transition: all 0.4s cubic-bezier(0.25, 1, 0.5, 1);
            overflow-y: auto; /* 只有内容超长时卡片内部才滚动 */
        }

        .card.active {
            opacity: 1;
            transform: translateX(0) scale(1);
            pointer-events: auto;
            z-index: 10;
        }

        .card.prev {
            opacity: 0;
            transform: translateX(-100px) scale(0.9);
            z-index: 5;
        }

        /* 配色 */
        .bg-intro { background-color: white; }
        .bg-shm { background-color: var(--accent-purple); }
        .bg-graph { background-color: var(--accent-blue); }
        .bg-energy { background-color: var(--accent-yellow); }
        .bg-res { background-color: var(--accent-green); }

        /* 内容排版 */
        h1 { font-size: 2.5rem; line-height: 1.1; margin-bottom: 15px; letter-spacing: -1px; }
        h2 { font-size: 1.5rem; margin-bottom: 10px; border-bottom: 3px solid black; display: inline-block; }
        p { font-size: 1rem; margin-bottom: 12px; line-height: 1.5; }
        
        .formula-box {
            background: white;
            border: 2px solid black;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
            font-family: 'Times New Roman', serif;
            font-size: 1.3rem;
            font-style: italic;
            border-radius: 12px;
            box-shadow: 4px 4px 0 rgba(0,0,0,0.1);
        }

        /* Canvas */
        .canvas-container {
            width: 100%;
            height: 180px;
            background: white;
            border: 2px solid black;
            border-radius: 12px;
            margin: 10px 0;
            position: relative;
        }
        canvas { width: 100%; height: 100%; display: block; }
        .canvas-tag {
            position: absolute;
            top: 5px; 
            left: 5px;
            background: rgba(255,255,255,0.9);
            padding: 2px 6px;
            font-size: 0.7rem;
            border: 1px solid black;
            border-radius: 4px;
        }

        /* 底部导航栏 */
        .nav-bar {
            margin-top: 30px;
            display: flex;
            gap: 20px;
            align-items: center;
            z-index: 100;
        }

        .nav-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: white;
            border: 3px solid black;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 4px 4px 0px black;
            transition: transform 0.1s;
        }

        .nav-btn:active {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0px black;
        }

        .nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            box-shadow: none;
            transform: translate(4px, 4px);
        }
        
        .page-indicator {
            font-weight: bold;
            font-size: 1.1rem;
        }

        /* 语言显示控制 */
        [lang="en"] { display: none; }
        body.lang-en [lang="en"] { display: block; }
        body.lang-en [lang="zh"] { display: none; }

    </style>
</head>
<body class="lang-zh">

    <div class="top-bar">
        <button class="lang-btn" id="langToggle">Switch to EN</button>
    </div>

    <div class="stage">
        
        <div class="card active bg-intro" data-index="0">
            <span style="font-size: 0.9rem; font-weight:bold; margin-bottom:10px;">Chapter 19</span>
            <h1 lang="zh">自然的<br>旋律</h1>
            <h1 lang="en">The Rhythm<br>of Nature</h1>
            
            <p lang="zh">从原子的微颤到高楼的摇摆，宇宙万物都在呼吸。</p>
            <p lang="en">From the vibration of atoms to the swaying of skyscrapers, the universe is breathing.</p>
            
            <p lang="zh">我们将这种往复运动称为——<br><strong>振动 (Oscillations)</strong>。</p>
            <p lang="en">We call this back-and-forth motion —<br><strong>Oscillations</strong>.</p>
            
            <div style="margin-top:auto; text-align:center; font-size:0.8rem; color:#666;">
                <span lang="zh">点击下方箭头开始 →</span>
                <span lang="en">Tap arrow to start →</span>
            </div>
        </div>

        <div class="card bg-intro" data-index="1">
            <h2 lang="zh">01. 描述语言</h2>
            <h2 lang="en">01. Terminology</h2>
            
            <p lang="zh">描述振动最核心的变量是<strong>角频率 (ω)</strong>。</p>
            <p lang="en">The key variable to describe oscillation is <strong>Angular Frequency (ω)</strong>.</p>
            
            <div class="canvas-container" id="c-circle">
                <canvas></canvas>
                <div class="canvas-tag">Projection of Circular Motion</div>
            </div>
            
            <div class="formula-box">
                ω = 2πf = 2π / T
            </div>
            
            <p lang="zh"><strong>相位差 (Phase)</strong>：描述步调是否一致。同相(In phase)是一起走，反相(Antiphase)是你左我右。</p>
            <p lang="en"><strong>Phase Difference</strong>: Tells if steps are synced. In phase = together; Antiphase = opposite.</p>
        </div>

        <div class="card bg-shm" data-index="2">
            <h2 lang="zh">02. 简谐运动 SHM</h2>
            <h2 lang="en">02. Defining SHM</h2>
            
            <p lang="zh">不是所有振动都叫 SHM。它必须满足一个苛刻的契约：</p>
            <p lang="en">Not all oscillations are SHM. It must satisfy a strict rule:</p>
            
            <div class="formula-box">
                a = -ω²x
            </div>
            
            <p lang="zh"><strong>负号的意义</strong>：加速度 a 的方向永远指向平衡位置（与位移 x 相反）。<br>就像有一根隐形的橡皮筋把你拉回家。</p>
            <p lang="en"><strong>The Minus Sign</strong>: Acceleration 'a' is always directed towards equilibrium (opposite to 'x').<br>Like an invisible rubber band pulling you home.</p>
        </div>

        <div class="card bg-graph" data-index="3">
            <h2 lang="zh">03. 图像与公式</h2>
            <h2 lang="en">03. Graphs & Eq</h2>
            
            <p lang="zh">时间流逝，振动画出了完美的波浪。</p>
            <p lang="en">Over time, oscillation traces a perfect wave.</p>
            
            <div class="canvas-container" id="c-wave">
                <canvas></canvas>
                <div class="canvas-tag">x-t Graph</div>
            </div>
            
            <div class="formula-box" style="font-size:1.1rem;">
                x = x₀ sin(ωt) <br>
                v₀ = ωx₀ (Max Velocity)
            </div>
            
            <p lang="zh" style="font-size:0.9rem">提示：在平衡位置(x=0)时速度最大；在两端时速度为0。</p>
            <p lang="en" style="font-size:0.9rem">Note: Velocity is max at equilibrium (x=0) and zero at extremes.</p>
        </div>

        <div class="card bg-energy" data-index="4">
            <h2 lang="zh">04. 能量守恒</h2>
            <h2 lang="en">04. Energy</h2>
            
            <p lang="zh">总能量在动能(Ek)和势能(Ep)之间倒来倒去。</p>
            <p lang="en">Total energy swaps between Kinetic (Ek) and Potential (Ep).</p>
            
            <div class="canvas-container" id="c-energy">
                <canvas></canvas>
                <div class="canvas-tag">Red: Ek | Blue: Ep</div>
            </div>
            
            <p lang="zh"><strong>重要考点</strong>：总能量与振幅的平方成正比。</p>
            <p lang="en"><strong>Exam Tip</strong>: Total Energy is proportional to Amplitude squared.</p>
            <div class="formula-box">
                E ∝ x₀²
            </div>
        </div>

        <div class="card bg-res" data-index="5">
            <h2 lang="zh">05. 共振</h2>
            <h2 lang="en">05. Resonance</h2>
            
            <p lang="zh">当<strong>驱动频率 ≈ 固有频率</strong>时，振幅达到最大。</p>
            <p lang="en">When <strong>Driving Freq ≈ Natural Freq</strong>, amplitude hits maximum.</p>
            
            <div class="canvas-container" id="c-res">
                <canvas></canvas>
                <div class="canvas-tag">Interaction Zone</div>
            </div>
            
            <button id="pushBtn" style="width:100%; padding:15px; background:black; color:white; border:none; border-radius:10px; font-weight:bold; cursor:pointer;">
                <span lang="zh">给它一推 (Push!)</span>
                <span lang="en">Push It!</span>
            </button>
            
            <p lang="zh" style="margin-top:10px; font-size:0.8rem">试着按节奏点击，制造共振！</p>
            <p lang="en" style="margin-top:10px; font-size:0.8rem">Tap rhythmically to create resonance!</p>
        </div>

    </div>

    <div class="nav-bar">
        <button class="nav-btn" id="prevBtn" disabled>&lt;</button>
        <span class="page-indicator" id="pageInd">1 / 6</span>
        <button class="nav-btn" id="nextBtn">&gt;</button>
    </div>

    <script>
        // --- 逻辑控制 ---
        const slides = document.querySelectorAll('.card');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const pageInd = document.getElementById('pageInd');
        const langBtn = document.getElementById('langToggle');
        let currentIndex = 0;
        let isEn = false;

        // 语言切换
        langBtn.addEventListener('click', () => {
            isEn = !isEn;
            document.body.classList.toggle('lang-en', isEn);
            document.body.classList.toggle('lang-zh', !isEn);
            langBtn.textContent = isEn ? "切换中文" : "Switch to EN";
        });

        // 翻页逻辑
        function updateSlide(index) {
            slides.forEach((slide, i) => {
                slide.classList.remove('active', 'prev');
                if (i === index) {
                    slide.classList.add('active');
                    // 激活当前页的Canvas
                    const canvas = slide.querySelector('canvas');
                    if(canvas) startCanvasAnimation(slide.dataset.index, canvas);
                } else if (i < index) {
                    slide.classList.add('prev');
                }
            });
            
            prevBtn.disabled = index === 0;
            nextBtn.disabled = index === slides.length - 1;
            pageInd.textContent = `${index + 1} / ${slides.length}`;
            currentIndex = index;
        }

        nextBtn.addEventListener('click', () => {
            if (currentIndex < slides.length - 1) updateSlide(currentIndex + 1);
        });

        prevBtn.addEventListener('click', () => {
            if (currentIndex > 0) updateSlide(currentIndex - 1);
        });

        // 键盘支持
        document.addEventListener('keydown', (e) => {
            if(e.key === 'ArrowRight') nextBtn.click();
            if(e.key === 'ArrowLeft') prevBtn.click();
        });

        // --- Canvas 动画引擎 (简化版) ---
        const oscillators = {};

        function startCanvasAnimation(index, canvas) {
            // 停止之前的动画以节省资源
            Object.values(oscillators).forEach(osc => osc.running = false);

            if (!oscillators[index]) {
                oscillators[index] = createOscillator(index, canvas);
            }
            oscillators[index].running = true;
            oscillators[index].animate();
        }

        function createOscillator(index, canvas) {
            const ctx = canvas.getContext('2d');
            let width = canvas.offsetWidth;
            let height = canvas.offsetHeight;
            canvas.width = width;
            canvas.height = height;

            let t = 0;
            let type = '';
            if(index == 1) type = 'circle';
            if(index == 3) type = 'wave';
            if(index == 4) type = 'energy';
            if(index == 5) type = 'res';

            // 共振物理参数
            let resPos = 0, resVel = 0;

            return {
                running: true,
                push: function() { resVel += 4; }, // 外部推力接口
                animate: function() {
                    if(!this.running) return;
                    ctx.clearRect(0, 0, width, height);
                    t += 0.05;

                    const cx = width / 2;
                    const cy = height / 2;
                    const amp = 40;

                    if(type === 'circle') {
                        // 圆与投影
                        const x = amp * Math.cos(t);
                        const y = amp * Math.sin(t);
                        ctx.beginPath(); ctx.arc(cx, cy, amp, 0, 7); ctx.strokeStyle='#eee'; ctx.stroke(); // Orbit
                        
                        // Ball
                        ctx.beginPath(); ctx.arc(cx + x, cy + y, 6, 0, 7); ctx.fillStyle='#E0BBE4'; ctx.fill(); ctx.stroke();
                        
                        // Projection
                        ctx.beginPath(); ctx.moveTo(cx+x, cy+y); ctx.lineTo(cx+x, height-20); ctx.setLineDash([4,4]); ctx.strokeStyle='#ccc'; ctx.stroke(); ctx.setLineDash([]);
                        ctx.beginPath(); ctx.arc(cx + x, height-20, 10, 0, 7); ctx.fillStyle='#111'; ctx.fill();
                    }
                    else if(type === 'wave') {
                        ctx.beginPath();
                        for(let i=0; i<width; i++) {
                            ctx.lineTo(i, cy + amp * Math.sin(i*0.05 - t));
                        }
                        ctx.strokeStyle = '#D6E4FF'; ctx.lineWidth=3; ctx.stroke();
                        ctx.lineWidth=1;
                        
                        // Point
                        let py = cy + amp * Math.sin(cx*0.05 - t);
                        ctx.beginPath(); ctx.arc(cx, py, 8, 0, 7); ctx.fillStyle='#111'; ctx.fill();
                    }
                    else if(type === 'energy') {
                        let x = amp * Math.sin(t);
                        let v = amp * Math.cos(t); // velocity proxy
                        
                        // Ball
                        ctx.beginPath(); ctx.arc(cx + x, cy, 10, 0, 7); ctx.fillStyle='#333'; ctx.fill();
                        
                        // Bars
                        let Ek = (amp*amp - x*x) * 0.04;
                        let Ep = (x*x) * 0.04;
                        
                        ctx.fillStyle='#FF6B6B'; ctx.fillRect(width-60, height-10, 20, -Ek); // Red Ek
                        ctx.fillStyle='#4ECDC4'; ctx.fillRect(width-30, height-10, 20, -Ep); // Blue Ep
                    }
                    else if(type === 'res') {
                        // Spring simulation
                        let k = 0.05, c = 0.02;
                        let acc = -k * resPos - c * resVel;
                        resVel += acc;
                        resPos += resVel;
                        
                        ctx.beginPath(); ctx.moveTo(cx, 0); ctx.lineTo(cx, cy + resPos); ctx.strokeStyle='#333'; ctx.stroke();
                        ctx.beginPath(); ctx.arc(cx, cy + resPos, 15, 0, 7); ctx.fillStyle='#D2F5E3'; ctx.fill(); ctx.stroke();
                    }

                    requestAnimationFrame(() => this.animate());
                }
            };
        }

        // 初始化第一页
        updateSlide(0);

        // 绑定共振按钮
        document.getElementById('pushBtn').addEventListener('click', () => {
            if(oscillators[5]) {
                oscillators[5].push();
                // 按钮动效
                const btn = document.getElementById('pushBtn');
                btn.style.transform = "scale(0.95)";
                setTimeout(()=>btn.style.transform="scale(1)", 100);
            }
        });

    </script>
</body>
</html>
